<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Internet Speeds Explorer — SDG 9 Showcase</title>

<!-- Fonts & libraries -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" />

<!-- Chart.js, Globe.gl, Three.js, html2canvas, jspdf -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://unpkg.com/three@0.153.0/build/three.min.js"></script>
<script src="https://unpkg.com/globe.gl"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --bg:#071427; --card:#0b1220; --muted:#9aa7b2; --accent:#7dd3fc; --accent2:#60a5fa; --text:#e6eef6;
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;height:100%;background:linear-gradient(180deg,#031026 0%,#071427 100%);color:var(--text);}
header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));backdrop-filter: blur(6px);}
.brand h1{margin:0;font-size:20px}
.subtitle{color:var(--muted);font-size:13px}
.controls{display:flex;gap:10px;align-items:center}
.btn{background:linear-gradient(180deg,var(--accent),var(--accent2));padding:8px 12px;border-radius:10px;color:#042027;border:none;cursor:pointer;font-weight:700}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--text)}
.container{max-width:1400px;margin:24px auto;padding:0 18px}
.panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;margin-bottom:16px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1}
input,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:rgba(255,255,255,0.03);color:var(--text)}
canvas{max-width:100%}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:12px}
.small{font-size:13px;color:var(--muted)}
#globeViz{width:100%;height:500px;border-radius:12px;background:#031026;}
footer{text-align:center;color:var(--muted);margin:18px 0}
.kpiRow{display:flex;gap:12px;flex-wrap:wrap}
.kpi{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;text-align:center;flex:1;min-width:120px}
@media(max-width:800px){.row{flex-direction:column}}
</style>
</head>
<body>
<header>
  <div class="brand">
    <h1>Internet Speeds Explorer — SDG 9</h1>
    <div class="subtitle">Industry, Innovation & Infrastructure — interactive global analysis</div>
  </div>
  <div class="controls">
    <label style="display:flex;align-items:center;gap:8px">
      <input id="csvFile" type="file" accept=".csv" style="display:none">
      <button id="uploadBtn" class="btn">Upload CSV</button>
    </label>
    <button id="useSample" class="btn ghost">Use Sample</button>
    <button id="exportReport" class="btn ghost">Export PDF</button>
  </div>
</header>

<main class="container">
  <section class="panel" data-aos="fade-up">
    <div class="row">
      <div class="col">
        <label class="small">Choose year</label>
        <select id="yearSelect">
          <option value="2024">2024</option>
          <option value="2023">2023</option>
          <option value="both">Compare 2023 vs 2024</option>
        </select>
      </div>
      <div class="col">
        <label class="small">Select countries (comma-separated)</label>
        <input id="countryInput" placeholder="e.g. USA, China, Germany" />
      </div>
      <div style="display:flex;align-items:end;gap:8px;width:200px">
        <button id="runQuery" class="btn">Run Query</button>
      </div>
    </div>
    <div class="results" style="margin-top:12px">
      <div class="kpiRow">
        <div class="kpi"><div class="small">Global avg (2024)</div><div id="kpiAvg" style="font-weight:800;font-size:20px">—</div></div>
        <div class="kpi"><div class="small">Countries improved</div><div id="kpiGrowth" style="font-weight:800;font-size:20px">—</div></div>
        <div class="kpi"><div class="small">SDG-9 Impact</div><div id="kpiImpact" style="font-weight:800;font-size:20px">—</div></div>
      </div>
    </div>
  </section>

  <section class="panel grid" data-aos="fade-up">
    <div class="card">
      <h3>Selected Country Comparison</h3>
      <canvas id="countryChart"></canvas>
    </div>
    <div class="card">
      <h3>Top Countries (2024)</h3>
      <canvas id="topChart"></canvas>
    </div>
    <div class="card">
      <h3>Outliers</h3>
      <div id="outliers" class="small">—</div>
    </div>
  </section>

  <section class="panel" data-aos="fade-up">
    <h3>Interactive 3D Globe</h3>
    <div id="globeViz"></div>
  </section>

  <section class="panel" data-aos="fade-up">
    <h3>Project Story — SDG 9</h3>
    <p class="small">This project highlights SDG 9: Industry, Innovation & Infrastructure. By visualizing internet speeds across countries and continents, we show where innovation is advancing digital infrastructure and which regions need investment. Use the filters, explore the 3D globe, and compare countries for deep insights!</p>
  </section>

  <footer><small>Built for STEAM Showcase — interactive, exportable, and SDG-9 focused.</small></footer>
</main>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
AOS.init();

// ---------- sample CSV ----------
const sampleCSV = `country,major_area,region,year2017,year2018,year2019,year2020,year2021,year2022,year2023,year2024
Afghanistan,Asia,Southern Asia,null,null,6.49,8.2,9.23,1.9,2.84,3.63
Albania,Europe,Southern Europe,11.48,14.71,28.61,37.11,41.47,33.67,46.47,62.71
Algeria,Africa,Northern Africa,3.98,3.52,4.06,3.92,9.95,10.84,11.3,14.26
Andorra,Europe,Southern Europe,null,null,110.34,129.69,145.18,85.92,93.94,110.00
Australia,Oceania,Australia and New Zealand,45.1,52.3,63.1,71.2,75.3,80.4,90.1,105.7
Brazil,Americas,South America,12.2,15.8,21.3,25.9,28.1,30.2,32.5,55.1
Canada,Americas,Northern America,30.1,40.5,50.2,62.3,70.1,72.0,75.9,88.0
China,Asia,Eastern Asia,70.2,75.1,80.5,85.7,90.2,92.5,95.3,120.4
Egypt,Africa,Northern Africa,7.5,8.2,9.1,10.0,11.5,12.2,13.4,14.6`;

// ---------- helpers ----------
function csvToRows(text){ return text.trim().split('\n').map(line=>line.split(',')); }
function parseRows(rows){
  const data=[];
  for(let i=1;i<rows.length;i++){
    const p = rows[i].map(s=>s.trim());
    if(p.length<11) continue;
    const country=p[0], majorArea=p[1], region=p[2];
    const s23 = (p[9]===''||p[9].toLowerCase()==='null')?0:parseFloat(p[9]);
    const s24 = (p[10]===''||p[10].toLowerCase()==='null')?0:parseFloat(p[10]);
    data.push({country,majorArea,region,speed2023:s23,speed2024:s24});
  }
  return data;
}

// ---------- state ----------
let records=[];
let countryChart=null, topChart=null, globe=null;

// ---------- DOM ----------
const csvFile=document.getElementById('csvFile');
const uploadBtn=document.getElementById('uploadBtn');
const useSample=document.getElementById('useSample');
const runQuery=document.getElementById('runQuery');
const yearSelect=document.getElementById('yearSelect');
const countryInput=document.getElementById('countryInput');
const kpiAvg=document.getElementById('kpiAvg');
const kpiGrowth=document.getElementById('kpiGrowth');
const kpiImpact=document.getElementById('kpiImpact');
const topList=document.getElementById('topList');
const outliersDiv=document.getElementById('outliers');

// ---------- file handling ----------
uploadBtn.addEventListener('click', ()=> csvFile.click());
csvFile.addEventListener('change',(e)=>{
  const f=e.target.files[0];
  if(!f) return;
  const reader=new FileReader();
  reader.onload=()=>{ const rows=csvToRows(reader.result); records=parseRows(rows); onDataLoaded(); };
  reader.readAsText(f);
});
useSample.addEventListener('click', ()=>{ records=parseRows(csvToRows(sampleCSV)); onDataLoaded(); });

// ---------- charts ----------
function drawBarChart(ctx, labels, values, label){
  if(ctx.chart) ctx.chart.destroy();
  ctx.chart = new Chart(ctx,{
    type:'bar',
    data:{labels, datasets:[{label,data:values,backgroundColor:'rgba(96,165,250,0.9)',borderRadius:6}]},
    options:{responsive:true,plugins:{legend:{display:false}, tooltip:{callbacks:{label:ctx=>ctx.formattedValue+' Mbps'}}},scales:{y:{beginAtZero:true}}}
  });
}

// ---------- compute KPIs ----------
function computeKPIs(){
  if(!records||records.length===0) return;
  const avg24 = records.reduce((s,r)=>s+r.speed2024,0)/records.length;
  const improved = records.filter(r=>r.speed2024-r.speed2023>0).length;
  const meanGrowth = records.reduce((a,b)=>a+b.speed2024-b.speed2023,0)/records.length;
  const impactScore = Math.max(0,(meanGrowth/(avg24||1))*100);
  kpiAvg.innerText=avg24.toFixed(2);
  kpiGrowth.innerText=improved;
  kpiImpact.innerText=impactScore.toFixed(1);
}

// ---------- run query ----------
runQuery.addEventListener('click',()=>{
  const year=yearSelect.value;
  const countries=countryInput.value.split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
  if(countries.length===0){ alert('Enter at least one country'); return; }
  const filtered=records.filter(r=>countries.includes(r.country.toLowerCase()));
  if(filtered.length===0){ alert('No matching countries'); return; }
  const ctx=document.getElementById('countryChart');
  const labels=filtered.map(r=>r.country);
  const values=filtered.map(r=>year==='2023'?r.speed2023:year==='2024'?r.speed2024: (r.speed2023+r.speed2024)/2 );
  drawBarChart(ctx, labels, values, 'Internet Speeds');
});

// ---------- Top 5 countries chart ----------
function drawTopCountries(){
  const sorted=records.slice().sort((a,b)=>b.speed2024-a.speed2024).slice(0,5);
  const labels=sorted.map(r=>r.country);
  const values=sorted.map(r=>r.speed2024);
  drawBarChart(document.getElementById('topChart'), labels, values, 'Top 5 2024');
}
drawTopCountries();

// ---------- Globe ----------
function addGlobe(){
  globe = Globe()
    .globeImageUrl('//unpkg.com/three-globe/example/img/earth-dark.jpg')
    .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
    .pointsData(records)
    .pointLat('lat')
    .pointLng('lng')
    .pointAltitude(r=>r.speed2024/150)
    .pointColor(r=>'rgba(96,165,250,0.8)')
    .pointLabel(r=>`${r.country}<br>2024: ${r.speed2024} Mbps`)
    .onPointClick(r=> alert(`${r.country}:\n2023: ${r.speed2023} Mbps\n2024: ${r.speed2024} Mbps`))
    .width(document.getElementById('globeViz').clientWidth)
    .height(document.getElementById('globeViz').clientHeight)
    .backgroundColor('#071427');
  document.getElementById('globeViz').appendChild(globe.renderer().domElement);
}
addGlobe();

// ---------- data loaded ----------
function onDataLoaded(){
  computeKPIs();
  drawTopCountries();
}

// ---------- export ----------
document.getElementById('exportReport').addEventListener('click', async ()=>{
  const node=document.querySelector('main.container');
  const canvas = await html2canvas(node,{scale:2,useCORS:true});
  const imgData=canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf=new jsPDF('p','mm','a4');
  const w=pdf.internal.pageSize.getWidth()-20;
  const imgProps = pdf.getImageProperties(imgData);
  const h=imgProps.height*(w/imgProps.width);
  pdf.addImage(imgData,'PNG',10,10,w,h);
  pdf.save('InternetSpeedsReport.pdf');
});

// ---------- init ----------
records=parseRows(csvToRows(sampleCSV));
onDataLoaded();
</script>
</body>
</html>
